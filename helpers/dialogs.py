from PyQt5 import QtCore, QtGui, QtWidgets


# noinspection PyUnresolvedReferences
class ConfigEditor(QtWidgets.QDialog):
    def __init__(self, callback: callable, old_values=None, old_name=None):
        super().__init__()
        self.callback = callback
        self.setupUi()
        if old_name is not None:
            self.name_input.setText(old_name)
            self.old_name = old_name
        if old_values is not None:
            if "ip" in old_values:
                self.ip_input.setText(old_values["ip"])
            if "port" in old_values:
                self.port_input.setText(str(old_values["port"]))
            if "password" in old_values:
                self.password_input.setText(old_values["password"])
        self.name_input.setValidator(QtGui.QRegExpValidator(QtCore.QRegExp(r"^[a-zA-Z0-9_ ]{1,30}$")))
        self.ip_input.setValidator(QtGui.QRegExpValidator(QtCore.QRegExp(r"^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$")))
        self.port_input.setValidator(QtGui.QRegExpValidator(QtCore.QRegExp(r"^\d{1,5}$")))

    # This function is auto-generated by pyuic, do not change as it may be overridden.
    # noinspection PyAttributeOutsideInit
    def setupUi(self):
        self.setObjectName("Dialog")
        self.resize(369, 124)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.sizePolicy().hasHeightForWidth())
        self.setSizePolicy(sizePolicy)
        self.dialog_button_box = QtWidgets.QDialogButtonBox(self)
        self.dialog_button_box.setGeometry(QtCore.QRect(10, 100, 351, 21))
        self.dialog_button_box.setFocusPolicy(QtCore.Qt.NoFocus)
        self.dialog_button_box.setOrientation(QtCore.Qt.Horizontal)
        self.dialog_button_box.setStandardButtons(QtWidgets.QDialogButtonBox.Cancel | QtWidgets.QDialogButtonBox.Save)
        self.dialog_button_box.setCenterButtons(False)
        self.dialog_button_box.setObjectName("dialog_button_box")
        self.horizontalLayoutWidget = QtWidgets.QWidget(self)
        self.horizontalLayoutWidget.setGeometry(QtCore.QRect(9, 40, 351, 22))
        self.horizontalLayoutWidget.setObjectName("horizontalLayoutWidget")
        self.ip_row = QtWidgets.QHBoxLayout(self.horizontalLayoutWidget)
        self.ip_row.setSizeConstraint(QtWidgets.QLayout.SetDefaultConstraint)
        self.ip_row.setContentsMargins(0, 0, 0, 0)
        self.ip_row.setObjectName("ip_row")
        self.ip_label = QtWidgets.QLabel(self.horizontalLayoutWidget)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.ip_label.sizePolicy().hasHeightForWidth())
        self.ip_label.setSizePolicy(sizePolicy)
        font = QtGui.QFont()
        font.setPointSize(10)
        self.ip_label.setFont(font)
        self.ip_label.setObjectName("ip_label")
        self.ip_row.addWidget(self.ip_label)
        self.ip_input = QtWidgets.QLineEdit(self.horizontalLayoutWidget)
        self.ip_input.setFocusPolicy(QtCore.Qt.StrongFocus)
        self.ip_input.setText("")
        self.ip_input.setPlaceholderText("")
        self.ip_input.setObjectName("ip_input")
        self.ip_row.addWidget(self.ip_input)
        self.port_label = QtWidgets.QLabel(self.horizontalLayoutWidget)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.port_label.sizePolicy().hasHeightForWidth())
        self.port_label.setSizePolicy(sizePolicy)
        font = QtGui.QFont()
        font.setPointSize(10)
        self.port_label.setFont(font)
        self.port_label.setObjectName("port_label")
        self.ip_row.addWidget(self.port_label)
        self.port_input = QtWidgets.QLineEdit(self.horizontalLayoutWidget)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Maximum, QtWidgets.QSizePolicy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.port_input.sizePolicy().hasHeightForWidth())
        self.port_input.setSizePolicy(sizePolicy)
        self.port_input.setMaximumSize(QtCore.QSize(51, 16777215))
        self.port_input.setSizeIncrement(QtCore.QSize(0, 0))
        self.port_input.setFocusPolicy(QtCore.Qt.StrongFocus)
        self.port_input.setPlaceholderText("")
        self.port_input.setObjectName("port_input")
        self.ip_row.addWidget(self.port_input)
        self.layoutWidget = QtWidgets.QWidget(self)
        self.layoutWidget.setGeometry(QtCore.QRect(10, 10, 351, 22))
        self.layoutWidget.setObjectName("layoutWidget")
        self.name_row = QtWidgets.QHBoxLayout(self.layoutWidget)
        self.name_row.setSizeConstraint(QtWidgets.QLayout.SetNoConstraint)
        self.name_row.setContentsMargins(0, 0, 0, 0)
        self.name_row.setObjectName("name_row")
        self.name_label = QtWidgets.QLabel(self.layoutWidget)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.name_label.sizePolicy().hasHeightForWidth())
        self.name_label.setSizePolicy(sizePolicy)
        font = QtGui.QFont()
        font.setPointSize(10)
        self.name_label.setFont(font)
        self.name_label.setObjectName("name_label")
        self.name_row.addWidget(self.name_label)
        self.name_input = QtWidgets.QLineEdit(self.layoutWidget)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Expanding, QtWidgets.QSizePolicy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.name_input.sizePolicy().hasHeightForWidth())
        self.name_input.setSizePolicy(sizePolicy)
        self.name_input.setFocusPolicy(QtCore.Qt.StrongFocus)
        self.name_input.setObjectName("name_input")
        self.name_row.addWidget(self.name_input)
        self.horizontalLayoutWidget_2 = QtWidgets.QWidget(self)
        self.horizontalLayoutWidget_2.setGeometry(QtCore.QRect(10, 70, 351, 22))
        self.horizontalLayoutWidget_2.setObjectName("horizontalLayoutWidget_2")
        self.password_row = QtWidgets.QHBoxLayout(self.horizontalLayoutWidget_2)
        self.password_row.setContentsMargins(0, 0, 0, 0)
        self.password_row.setObjectName("password_row")
        self.password_label = QtWidgets.QLabel(self.horizontalLayoutWidget_2)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.password_label.sizePolicy().hasHeightForWidth())
        self.password_label.setSizePolicy(sizePolicy)
        font = QtGui.QFont()
        font.setPointSize(10)
        self.password_label.setFont(font)
        self.password_label.setObjectName("password_label")
        self.password_row.addWidget(self.password_label)
        self.password_input = QtWidgets.QLineEdit(self.horizontalLayoutWidget_2)
        self.password_input.setInputMask("")
        self.password_input.setEchoMode(QtWidgets.QLineEdit.Password)
        self.password_input.setObjectName("password_input")
        self.password_row.addWidget(self.password_input)

        self.retranslateUi()
        self.dialog_button_box.accepted.connect(self.accept)
        self.dialog_button_box.rejected.connect(self.reject)
        QtCore.QMetaObject.connectSlotsByName(self)
        self.setTabOrder(self.name_input, self.ip_input)
        self.setTabOrder(self.ip_input, self.port_input)

    def retranslateUi(self):
        _translate = QtCore.QCoreApplication.translate
        self.setWindowTitle(_translate("Dialog", "Configuration Manager"))
        self.ip_label.setText(_translate("Dialog", "*IP"))
        self.port_label.setText(_translate("Dialog", "*Port"))
        self.name_label.setText(_translate("Dialog", "*Name"))
        self.password_label.setText(_translate("Dialog", "Password"))

    def accept(self):
        name = self.name_input.text()
        ip = self.ip_input.text()
        port = self.port_input.text()
        if not name or not ip or not port:
            return QtWidgets.QMessageBox.warning(self, "Error", "Please fill all fields marked with an asterisk (*)")
        password = self.password_input.text()
        old_name = self.old_name if hasattr(self, "old_name") and self.old_name != self.name_input.text() else None
        self.callback(name, ip, int(port), password, old_name)
        super().accept()


# noinspection PyUnresolvedReferences
class ConfigReorderDialog(QtWidgets.QDialog):
    def __init__(self, callback: callable, old_order: list):
        super().__init__()
        self.callback = callback
        self.setupUi()
        self.list.addItems(old_order)

    # This function is auto-generated by pyuic, do not change as it may be overridden.
    # noinspection PyAttributeOutsideInit
    def setupUi(self):
        self.setObjectName("Dialog")
        self.resize(391, 272)
        self.master_grid = QtWidgets.QGridLayout(self)
        self.master_grid.setObjectName("master_grid")
        self.scroll_area = QtWidgets.QScrollArea(self)
        self.scroll_area.setWidgetResizable(True)
        self.scroll_area.setObjectName("scroll_area")
        self.scroll_area_contents = QtWidgets.QWidget()
        self.scroll_area_contents.setGeometry(QtCore.QRect(0, 0, 371, 223))
        self.scroll_area_contents.setObjectName("scroll_area_contents")
        self.list = QtWidgets.QListWidget(self.scroll_area_contents)
        self.list.setGeometry(QtCore.QRect(0, 0, 371, 231))
        self.list.setFrameShape(QtWidgets.QFrame.NoFrame)
        self.list.setDragEnabled(True)
        self.list.setDragDropMode(QtWidgets.QAbstractItemView.DragDrop)
        self.list.setDefaultDropAction(QtCore.Qt.MoveAction)
        self.list.setObjectName("list")
        self.scroll_area.setWidget(self.scroll_area_contents)
        self.master_grid.addWidget(self.scroll_area, 0, 0, 1, 1)
        self.dialog_button_box = QtWidgets.QDialogButtonBox(Dialog)
        self.dialog_button_box.setOrientation(QtCore.Qt.Horizontal)
        self.dialog_button_box.setStandardButtons(QtWidgets.QDialogButtonBox.Cancel | QtWidgets.QDialogButtonBox.Save)
        self.dialog_button_box.setObjectName("dialog_button_box")
        self.master_grid.addWidget(self.dialog_button_box, 1, 0, 1, 1)

        self.retranslateUi()
        self.dialog_button_box.accepted.connect(self.accept)
        self.dialog_button_box.rejected.connect(self.reject)
        QtCore.QMetaObject.connectSlotsByName(self)

    def retranslateUi(self):
        _translate = QtCore.QCoreApplication.translate
        self.setWindowTitle(_translate("Dialog", "Reorder Configurations"))

    def accept(self):
        self.callback([self.list.item(i).text() for i in range(self.list.count())])
        super().accept()
